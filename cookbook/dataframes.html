

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Using external data &mdash; Pywr 0.5dev documentation</title>
  

  
  
  
  

  

  
  
    

  

  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Aggregated parameters" href="aggregated_parameter.html" />
    <link rel="prev" title="Demand saving" href="demand_saving.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Pywr
          

          
          </a>

          
            
            
              <div class="version">
                0.5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installing Pywr</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../formulation.html">Problem formulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../json.html">JSON model format</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="cookbook.html">Cookbook</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="demand_saving.html">Demand restrictions</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">External data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#supported-formats">Supported formats</a></li>
<li class="toctree-l3"><a class="reference internal" href="#examples">Examples</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#timeseries">Timeseries</a></li>
<li class="toctree-l4"><a class="reference internal" href="#constants">Constants</a></li>
<li class="toctree-l4"><a class="reference internal" href="#monthly-profiles">Monthly profiles</a></li>
<li class="toctree-l4"><a class="reference internal" href="#multi-index">Multi-index</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#tables">Tables</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="aggregated_parameter.html">Aggregated parameters</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api/pywr.html">Python API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Pywr</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="cookbook.html">Pywr cookbook examples</a> &raquo;</li>
        
      <li>Using external data</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/cookbook/dataframes.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="using-external-data">
<h1>Using external data<a class="headerlink" href="#using-external-data" title="Permalink to this headline">¶</a></h1>
<p>It’s not always practical or desirable to store all the data required by a model in the JSON document. This is particularly true when working with large amounts of timeseries data, but is also applicable to data better stored in a tabular format.</p>
<p>Many parameter types support loading data from an external file using the <code class="docutils literal notranslate"><span class="pre">&quot;url&quot;</span></code> keyword. The data is loaded during the setup/reset process, before the model is run.</p>
<div class="section" id="supported-formats">
<h2>Supported formats<a class="headerlink" href="#supported-formats" title="Permalink to this headline">¶</a></h2>
<p>Support for the following data formats is available via the <a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/io.html">Pandas</a> module.</p>
<blockquote>
<div><ul class="simple">
<li>Comma separated values (.csv)</li>
<li>Excel (.xls, .xlsx)</li>
<li>HDF5 (.h5)</li>
</ul>
</div></blockquote>
<p><strong>Warning:</strong> When reading Excel documents formulae are supported but not re-evaluated and links are not updated; the value read is the value present when the document was last saved.</p>
<p>When working with large amounts of timeseries data the <a class="reference external" href="https://www.hdfgroup.org/why-hdf/">HDF5 format</a> is recommended as it has superior read speeds. Data in an HDF5 file should be in the “fixed” format; this is achieved by passing the <code class="docutils literal notranslate"><span class="pre">format=&quot;fixed&quot;</span></code> argument to <code class="docutils literal notranslate"><span class="pre">DataFrame.to_hdf</span></code>. Where data access speed is critical, users are advised to look at the <code class="docutils literal notranslate"><span class="pre">TablesArrayParameter</span></code> parameter instead which supports very fast access via <cite>pytables</cite> directly (rather than indirectly via <cite>pandas</cite>).</p>
<p>External data is read using the appropriate <code class="docutils literal notranslate"><span class="pre">pandas.read_xxx</span></code> function determined by the file extension (e.g. <code class="docutils literal notranslate"><span class="pre">pandas.read_excel</span></code> for xls/xlsx). Keywords that are not recognised by Pywr are passed on to these functions. For example, when reading timeseries data from a CSV you can parse the date strings into pandas timestamps by passing <code class="docutils literal notranslate"><span class="pre">parse_dates=True</span></code> (see example below).</p>
</div>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<div class="section" id="timeseries">
<h3>Timeseries<a class="headerlink" href="#timeseries" title="Permalink to this headline">¶</a></h3>
<p>The most common kind of data to store in an external file is timeseries data. For example, the flow used by a <code class="docutils literal notranslate"><span class="pre">Catchment</span></code> node.</p>
<p>An example dataset is given below with three columns: a timestamp (used as the index), rainfall and flow.</p>
<table border="1" class="colwidths-given docutils" id="id1">
<caption><span class="caption-text">timeseries1.csv</span><a class="headerlink" href="#id1" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="43%" />
<col width="29%" />
<col width="29%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Timestamp</th>
<th class="head">Rainfall</th>
<th class="head">Flow</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1910-01-01</td>
<td>0.0</td>
<td>23.920</td>
</tr>
<tr class="row-odd"><td>1910-01-02</td>
<td>1.8</td>
<td>22.140</td>
</tr>
<tr class="row-even"><td>1910-01-03</td>
<td>5.2</td>
<td>22.570</td>
</tr>
</tbody>
</table>
<p>The parameter below references the <cite>timeseries1.csv</cite> file in its <code class="docutils literal notranslate"><span class="pre">&quot;url&quot;</span></code>. The index column is defined by <code class="docutils literal notranslate"><span class="pre">&quot;index_col&quot;</span></code> and the data column is defined by the <code class="docutils literal notranslate"><span class="pre">&quot;column&quot;</span></code> keyword (in this case, <code class="docutils literal notranslate"><span class="pre">&quot;Flow&quot;</span></code>). The <code class="docutils literal notranslate"><span class="pre">&quot;parse_dates&quot;</span></code> keyword is required in order to parse the dates from strings in the CSV file into pandas date objects.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;flow&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;dataframe&quot;</span><span class="p">,</span>
    <span class="s2">&quot;url&quot;</span><span class="o">:</span> <span class="s2">&quot;timeseries1.csv&quot;</span><span class="p">,</span>
    <span class="s2">&quot;index_col&quot;</span><span class="o">:</span> <span class="s2">&quot;Timestamp&quot;</span>
    <span class="s2">&quot;parse_dates&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="s2">&quot;column&quot;</span><span class="o">:</span> <span class="s2">&quot;Flow&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If the index column of the dataframe is a timestamp the parameter will support automatic resampling, if required. For example, if the external data is on a daily timestep the model can still be run on a weekly timestep. In this case the data mean flow for the week is used. Only subsampling is currently supported (e.g. you can go from daily to monthly, but not monthly to daily).</p>
</div>
<div class="section" id="constants">
<h3>Constants<a class="headerlink" href="#constants" title="Permalink to this headline">¶</a></h3>
<p>Constant parameters can also load their data from an external source. This is useful when data with a common theme is stored in a table. For example, the demand for different nodes in the model.</p>
<p>An example is given below with the population and demand for three different cities (not real data!).</p>
<table border="1" class="colwidths-given docutils" id="id2">
<caption><span class="caption-text">demands.csv</span><a class="headerlink" href="#id2" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="43%" />
<col width="29%" />
<col width="29%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">City</th>
<th class="head">Population</th>
<th class="head">Demand</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Oxford</td>
<td>30,294</td>
<td>20.3</td>
</tr>
<tr class="row-odd"><td>Cambridge</td>
<td>28,403</td>
<td>19.4</td>
</tr>
<tr class="row-even"><td>London</td>
<td>790,930</td>
<td>520.9</td>
</tr>
</tbody>
</table>
<p>As in the previous example, the filename is passed to the <code class="docutils literal notranslate"><span class="pre">&quot;url&quot;</span></code> keyword. The <code class="docutils literal notranslate"><span class="pre">&quot;index_col&quot;</span></code> keyword defines which column should be used for the lookups, with the <code class="docutils literal notranslate"><span class="pre">&quot;index&quot;</span></code> keyword specifying the lookup key.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;max_flow_oxford&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;constant&quot;</span><span class="p">,</span>
    <span class="s2">&quot;url&quot;</span><span class="o">:</span> <span class="s2">&quot;demands.csv&quot;</span><span class="p">,</span>
    <span class="s2">&quot;index_col&quot;</span><span class="o">:</span> <span class="s2">&quot;City&quot;</span>
    <span class="s2">&quot;index&quot;</span><span class="o">:</span> <span class="s2">&quot;Oxford&quot;</span>
    <span class="s2">&quot;column&quot;</span><span class="o">:</span> <span class="s2">&quot;Demand&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="monthly-profiles">
<h3>Monthly profiles<a class="headerlink" href="#monthly-profiles" title="Permalink to this headline">¶</a></h3>
<p>Monthly profiles can also be loaded from an external data source. Instead of passing a <code class="docutils literal notranslate"><span class="pre">&quot;column&quot;</span></code> keyword, the parameter expects the data source to have 12 columns (plus 1 for the index). The names of the columns are not important.</p>
<table border="1" class="colwidths-given docutils" id="id3">
<caption><span class="caption-text">demands_monthly.csv</span><a class="headerlink" href="#id3" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="23%" />
<col width="15%" />
<col width="15%" />
<col width="15%" />
<col width="15%" />
<col width="15%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">City</th>
<th class="head">Jan</th>
<th class="head">Feb</th>
<th class="head">Mar</th>
<th class="head">…</th>
<th class="head">Dec</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Oxford</td>
<td>23.43</td>
<td>25.32</td>
<td>24.24</td>
<td>…</td>
<td>21.24</td>
</tr>
<tr class="row-odd"><td>Cambridge</td>
<td>11.23</td>
<td>14.34</td>
<td>13.23</td>
<td>…</td>
<td>12.23</td>
</tr>
</tbody>
</table>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;max_flow&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;monthlyprofile&quot;</span><span class="p">,</span>
    <span class="s2">&quot;url&quot;</span><span class="o">:</span> <span class="s2">&quot;demands_monthly.csv&quot;</span><span class="p">,</span>
    <span class="s2">&quot;index_col&quot;</span><span class="o">:</span> <span class="s2">&quot;City&quot;</span><span class="p">,</span>
    <span class="s2">&quot;index&quot;</span><span class="o">:</span> <span class="s2">&quot;Oxford&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="multi-index">
<h3>Multi-index<a class="headerlink" href="#multi-index" title="Permalink to this headline">¶</a></h3>
<p>Multi-indexing of dataframes is supported by passing a list to the <code class="docutils literal notranslate"><span class="pre">&quot;index_col&quot;</span></code> keyword. Both numeric and string indexes are valid.</p>
<table border="1" class="colwidths-given docutils" id="id4">
<caption><span class="caption-text">multiindex_data.csv</span><a class="headerlink" href="#id4" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="22%" />
<col width="33%" />
<col width="22%" />
<col width="22%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">level</th>
<th class="head">node</th>
<th class="head">max_flow</th>
<th class="head">cost</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0</td>
<td>demand1</td>
<td>10</td>
<td>-10</td>
</tr>
<tr class="row-odd"><td>0</td>
<td>demand2</td>
<td>20</td>
<td>-20</td>
</tr>
<tr class="row-even"><td>1</td>
<td>demand1</td>
<td>100</td>
<td>-100</td>
</tr>
<tr class="row-odd"><td>1</td>
<td>demand2</td>
<td>200</td>
<td>-200</td>
</tr>
</tbody>
</table>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;DC1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;output&quot;</span><span class="p">,</span>
    <span class="s2">&quot;max_flow&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;constant&quot;</span><span class="p">,</span>
        <span class="s2">&quot;url&quot;</span><span class="o">:</span> <span class="s2">&quot;multiindex_data.csv&quot;</span><span class="p">,</span>
        <span class="s2">&quot;column&quot;</span><span class="o">:</span> <span class="s2">&quot;max_flow&quot;</span><span class="p">,</span>
        <span class="s2">&quot;index&quot;</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;demand1&quot;</span><span class="p">],</span>
        <span class="s2">&quot;index_col&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;level&quot;</span><span class="p">,</span> <span class="s2">&quot;node&quot;</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="s2">&quot;cost&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;constant&quot;</span><span class="p">,</span>
        <span class="s2">&quot;url&quot;</span><span class="o">:</span> <span class="s2">&quot;multiindex_data.csv&quot;</span><span class="p">,</span>
        <span class="s2">&quot;column&quot;</span><span class="o">:</span> <span class="s2">&quot;cost&quot;</span><span class="p">,</span>
        <span class="s2">&quot;index&quot;</span><span class="o">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;demand1&quot;</span><span class="p">],</span>
        <span class="s2">&quot;index_col&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;level&quot;</span><span class="p">,</span> <span class="s2">&quot;node&quot;</span><span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In the example above, <em>max_flow</em> evaluates to 10 and <em>cost</em> evaluates to -100.</p>
</div>
</div>
<div class="section" id="tables">
<h2>Tables<a class="headerlink" href="#tables" title="Permalink to this headline">¶</a></h2>
<p>Each time an external data source is referenced using the <code class="docutils literal notranslate"><span class="pre">&quot;url&quot;</span></code> keyword the data is reloaded from disk. If a dataset is going to be used multiple times in a model it can be defined in the <code class="docutils literal notranslate"><span class="pre">&quot;tables&quot;</span></code> section of the JSON document. In this way the data will only be loaded once. Parameters can then reference the data using the <code class="docutils literal notranslate"><span class="pre">&quot;table&quot;</span></code> keyword instead of the <code class="docutils literal notranslate"><span class="pre">&quot;url&quot;</span></code> keyword. Although the index column applied to the data must be defined in the <code class="docutils literal notranslate"><span class="pre">&quot;tables&quot;</span></code> section, the index used for each lookup can be different.</p>
<p>An example is given below using the <cite>demands.csv</cite> dataset shown previously. Two constant parameters are defined referencing data in the table.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;parameters&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;oxford_demand&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;constant&quot;</span><span class="p">,</span>
        <span class="s2">&quot;table&quot;</span><span class="o">:</span> <span class="s2">&quot;simple_data&quot;</span><span class="p">,</span>
        <span class="s2">&quot;column&quot;</span><span class="o">:</span> <span class="s2">&quot;Demand&quot;</span><span class="p">,</span>
        <span class="s2">&quot;index&quot;</span><span class="o">:</span> <span class="s2">&quot;Oxford&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;cambridge_demand&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;constant&quot;</span><span class="p">,</span>
        <span class="s2">&quot;table&quot;</span><span class="o">:</span> <span class="s2">&quot;simple_data&quot;</span><span class="p">,</span>
        <span class="s2">&quot;column&quot;</span><span class="o">:</span> <span class="s2">&quot;Demand&quot;</span><span class="p">,</span>
        <span class="s2">&quot;index&quot;</span><span class="o">:</span> <span class="s2">&quot;Cambridge&quot;</span>
    <span class="p">}</span>
<span class="p">},</span>
<span class="s2">&quot;tables&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;simple_data&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;url&quot;</span><span class="o">:</span> <span class="s2">&quot;demands.csv&quot;</span><span class="p">,</span>
        <span class="s2">&quot;index_col&quot;</span><span class="o">:</span> <span class="s2">&quot;City&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="aggregated_parameter.html" class="btn btn-neutral float-right" title="Aggregated parameters" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="demand_saving.html" class="btn btn-neutral" title="Demand saving" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Copyright (C) 2014-17 Joshua Arnott, James E. Tomlinson, Atkins, University of Manchester.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.5dev',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>